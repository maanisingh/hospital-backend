#!/bin/bash

# Comprehensive RBAC Application Script
# This script documents all RBAC changes needed across all route files

echo "ðŸ”’ RBAC Comprehensive Application Report"
echo "=========================================="
echo ""

echo "âœ… COMPLETED:"
echo "  - middleware/rbac.js created"
echo "  - routes/users.js - Full RBAC (User Management)"
echo "  - routes/departments.js - Fixed department & bed management"
echo "  - routes/patients.js - Partial RBAC (needs completion)"
echo ""

echo "â³ REMAINING ROUTE FILES TO FIX:"
echo ""

echo "1. routes/opd.js - OPD Module"
echo "   Needs:"
echo "   - GET /tokens â†’ requirePermission('OPD_ACCESS')"
echo "   - POST /tokens â†’ requirePermission('OPD_ACCESS')"
echo "   - GET /queue â†’ requirePermission('OPD_ACCESS')"
echo "   - POST /call-next â†’ requirePermission('OPD_CONSULTATION')"
echo "   - POST /complete â†’ requirePermission('OPD_CONSULTATION')"
echo ""

echo "2. routes/appointments.js - Appointments"
echo "   Needs:"
echo "   - GET / â†’ requirePermission('OPD_ACCESS')"
echo "   - POST / â†’ requirePermission('OPD_ACCESS')"
echo "   - GET /:id â†’ requirePermission('OPD_ACCESS')"
echo "   - PATCH /:id â†’ requirePermission('OPD_ACCESS')"
echo "   - DELETE /:id â†’ requireAdmin()"
echo ""

echo "3. routes/ipd.js - IPD Module"
echo "   Needs:"
echo "   - GET /admissions â†’ requirePermission('IPD_ACCESS')"
echo "   - POST /admissions â†’ requirePermission('IPD_ACCESS')"
echo "   - GET /admissions/:id â†’ requirePermission('IPD_ACCESS')"
echo "   - PATCH /admissions/:id â†’ requirePermission('IPD_ACCESS')"
echo "   - POST /discharge â†’ requirePermission('IPD_DISCHARGE')"
echo ""

echo "4. routes/pharmacy.js - Pharmacy Module"
echo "   Needs:"
echo "   - GET /medicines â†’ requirePermission('PHARMACY_READ')"
echo "   - POST /medicines â†’ requirePermission('PHARMACY_MANAGE')"
echo "   - GET /medicines/:id â†’ requirePermission('PHARMACY_READ')"
echo "   - PATCH /medicines/:id â†’ requirePermission('PHARMACY_MANAGE')"
echo "   - GET /prescriptions â†’ requirePermission('PHARMACY_READ')"
echo "   - POST /prescriptions â†’ requirePermission('PRESCRIPTION_CREATE')"
echo "   - GET /prescriptions/:id â†’ requirePermission('PHARMACY_READ')"
echo "   - POST /orders â†’ requirePermission('PHARMACY_MANAGE')"
echo ""

echo "5. routes/lab.js - Lab Module"
echo "   Needs:"
echo "   - GET /tests â†’ requirePermission('LAB_ORDER')"
echo "   - POST /tests â†’ requirePermission('LAB_ORDER')"
echo "   - GET /tests/:id â†’ requirePermission('LAB_ORDER')"
echo "   - PATCH /tests/:id/sample â†’ requirePermission('LAB_PROCESS')"
echo "   - PATCH /tests/:id/results â†’ requirePermission('LAB_RESULTS')"
echo ""

echo "6. routes/radiology.js - Radiology Module"
echo "   Needs:"
echo "   - GET /tests â†’ requirePermission('RADIOLOGY_ORDER')"
echo "   - POST /tests â†’ requirePermission('RADIOLOGY_ORDER')"
echo "   - GET /tests/:id â†’ requirePermission('RADIOLOGY_ORDER')"
echo "   - PATCH /tests/:id â†’ requirePermission('RADIOLOGY_PROCESS')"
echo ""

echo "7. routes/billing.js - Billing Module"
echo "   Needs:"
echo "   - GET /invoices â†’ requirePermission('BILLING_VIEW')"
echo "   - POST /invoices â†’ requirePermission('BILLING_MANAGE')"
echo "   - GET /invoices/:id â†’ requirePermission('BILLING_VIEW')"
echo "   - POST /payments â†’ requirePermission('BILLING_MANAGE')"
echo "   - GET /statistics â†’ requirePermission('BILLING_REPORTS')"
echo ""

echo "8. routes/organizations.js - Organization Management"
echo "   Needs:"
echo "   - GET / â†’ requirePermission('ORG_VIEW')"
echo "   - POST / â†’ requireSuperAdmin()"
echo "   - GET /:id â†’ requirePermission('ORG_VIEW')"
echo "   - PATCH /:id â†’ requireAdmin()"
echo "   - DELETE /:id â†’ requireSuperAdmin()"
echo ""

echo "9. routes/patients.js - Patient Management (PARTIAL)"
echo "   Needs completion for all routes"
echo ""

echo ""
echo "ðŸ“‹ MANUAL FIX REQUIRED:"
echo "Each route file needs middleware added to route definitions"
echo "Pattern:"
echo "  router.get('/path', authenticateToken, requirePermission('GROUP'), async (req, res) => {"
echo ""
echo "See APPLY_RBAC_PLAN.md for detailed permissions matrix"
