========================================
Hospital SaaS Backend - Comprehensive Testing
Started: Tue Dec  2 08:33:54 PM UTC 2025
API URL: https://hospital-api.alexandratechlab.com
========================================

[0;34m=== 1. Authentication Module Tests ===[0m
Testing: Health Check... [0;32mâœ“ PASSED[0m (HTTP 200)
Logging in to get access token...
[0;32mâœ“ Successfully obtained access token[0m
Testing: Invalid Login... [0;32mâœ“ PASSED[0m (HTTP 401)
Testing: Get Current User... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Unauthorized Access... [0;32mâœ“ PASSED[0m (HTTP 403)

[0;34m=== 2. Organization Module Tests ===[0m
Testing: List Organizations... [0;32mâœ“ PASSED[0m (HTTP 200)
[0;32mâœ“ Organization created with ID: 0faf3b35-5ba1-41e1-8d47-bf17e3d76627[0m
Testing: Get Organization by ID... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Update Organization... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get Organization Stats... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 3. Patient Management Tests ===[0m
[0;32mâœ“ Patient created with ID: dae414a4-cbe0-4e40-8586-1f7f7b9123fa, Code: PAT001[0m
Testing: List Patients... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get Patient by ID... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get Patient by Code... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Update Patient... [0;31mâœ— FAILED[0m (Expected: 200, Got: 404)
Response: {"errors":[{"message":"Patient not found"}]}
Testing: Get Patient History... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 4. Department & Bed Management Tests ===[0m
[0;32mâœ“ Department created with ID: 868125ab-2c39-4eb4-9c77-ce1ec488e261[0m
Testing: List Departments... [0;32mâœ“ PASSED[0m (HTTP 200)
[0;32mâœ“ Bed created with ID: d04008cc-05d1-4db8-bcd3-9d9a3b7d1d8e[0m
Testing: Get Available Beds... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Assign Bed to Patient... [0;31mâœ— FAILED[0m (Expected: 201, Got: 500)
Response: {"errors":[{"message":"Cannot read properties of undefined (reading 'create')"}]}

[0;34m=== 5. OPD Module Tests ===[0m
[0;32mâœ“ OPD Token created with ID: d48a2428-a814-4ee7-bfd2-9b40091eb2f4[0m
Testing: List OPD Tokens... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get OPD Queue Status... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Call Next Patient... [0;31mâœ— FAILED[0m (Expected: 200, Got: 500)
Response: {"errors":[{"message":"\nInvalid `prisma.oPDToken.update()` invocation in\n/root/hospital-backend/routes/opd.js:364:48\n\n  361   });\n  362 }\n  363 \nâ†’ 364 const updatedToken = await prisma.oPDToken.update({\n        where: {\n          id: \"d48a2428-a814-4ee7-bfd2-9b40091eb2f4\"\n        },\n        data: {\n          status: \"in_consultation\",\n          consultationStartTime: new Date(\"2025-12-02T20:33:56.792Z\"),\n          ~~~~~~~~~~~~~~~~~~~~~\n      ?   id?: String | StringFieldUpdateOperationsInput,\n      ?   tokenNumber?: Int | IntFieldUpdateOperationsInput,\n      ?   tokenDate?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   priority?: String | StringFieldUpdateOperationsInput,\n      ?   symptoms?: String | NullableStringFieldUpdateOperationsInput | Null,\n      ?   diagnosis?: String | NullableStringFieldUpdateOperationsInput | Null,\n      ?   prescription?: NullableJsonNullValueInput | Json,\n      ?   notes?: String | NullableStringFieldUpdateOperationsInput | Null,\n      ?   consultationFee?: Decimal | NullableDecimalFieldUpdateOperationsInput | Null,\n      ?   calledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,\n      ?   completedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,\n      ?   dateCreated?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   dateUpdated?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   organization?: OrganizationUpdateOneRequiredWithoutOpdTokensNestedInput,\n      ?   patient?: PatientUpdateOneRequiredWithoutOpdTokensNestedInput,\n      ?   doctor?: UserUpdateOneWithoutOpdTokensAsDoctorNestedInput,\n      ?   department?: DepartmentUpdateOneWithoutOpdTokensNestedInput\n        },\n        include: {\n          patient: true,\n          department: true,\n          doctor: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              email: true\n            }\n          }\n        }\n      })\n\nUnknown argument `consultationStartTime`. Available options are marked with ?."}]}
Testing: Complete Consultation... [0;31mâœ— FAILED[0m (Expected: 200, Got: 500)
Response: {"errors":[{"message":"\nInvalid `prisma.oPDToken.update()` invocation in\n/root/hospital-backend/routes/opd.js:416:48\n\n  413   });\n  414 }\n  415 \nâ†’ 416 const updatedToken = await prisma.oPDToken.update({\n        where: {\n          id: \"d48a2428-a814-4ee7-bfd2-9b40091eb2f4\"\n        },\n        data: {\n          status: \"completed\",\n          consultationEndTime: new Date(\"2025-12-02T20:33:56.886Z\"),\n          ~~~~~~~~~~~~~~~~~~~\n          diagnosis: \"Stable angina\",\n          prescription: \"Nitroglycerin\",\n          followUpDate: null,\n          doctorNotes: undefined,\n          vitalSigns: undefined,\n      ?   id?: String | StringFieldUpdateOperationsInput,\n      ?   tokenNumber?: Int | IntFieldUpdateOperationsInput,\n      ?   tokenDate?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   priority?: String | StringFieldUpdateOperationsInput,\n      ?   symptoms?: String | NullableStringFieldUpdateOperationsInput | Null,\n      ?   notes?: String | NullableStringFieldUpdateOperationsInput | Null,\n      ?   consultationFee?: Decimal | NullableDecimalFieldUpdateOperationsInput | Null,\n      ?   calledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,\n      ?   completedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,\n      ?   dateCreated?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   dateUpdated?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   organization?: OrganizationUpdateOneRequiredWithoutOpdTokensNestedInput,\n      ?   patient?: PatientUpdateOneRequiredWithoutOpdTokensNestedInput,\n      ?   doctor?: UserUpdateOneWithoutOpdTokensAsDoctorNestedInput,\n      ?   department?: DepartmentUpdateOneWithoutOpdTokensNestedInput\n        },\n        include: {\n          patient: true,\n          department: true,\n          doctor: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              email: true\n            }\n          }\n        }\n      })\n\nUnknown argument `consultationEndTime`. Available options are marked with ?."}]}
Testing: Get OPD Statistics... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 6. Appointments Module Tests ===[0m
[0;32mâœ“ Appointment created with ID: 33be97d1-1c8c-41c0-851c-e1755a197451[0m
Testing: List Appointments... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Confirm Appointment... [0;31mâœ— FAILED[0m (Expected: 200, Got: 500)
Response: {"errors":[{"message":"\nInvalid `prisma.appointment.update()` invocation in\n/root/hospital-backend/routes/appointments.js:411:57\n\n  408   });\n  409 }\n  410 \nâ†’ 411 const updatedAppointment = await prisma.appointment.update({\n        where: {\n          id: \"33be97d1-1c8c-41c0-851c-e1755a197451\"\n        },\n        data: {\n          status: \"confirmed\",\n          confirmedAt: new Date(\"2025-12-02T20:33:57.267Z\"),\n          ~~~~~~~~~~~\n      ?   id?: String | StringFieldUpdateOperationsInput,\n      ?   appointmentDate?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   appointmentTime?: String | StringFieldUpdateOperationsInput,\n      ?   appointmentType?: String | StringFieldUpdateOperationsInput,\n      ?   reason?: String | NullableStringFieldUpdateOperationsInput | Null,\n      ?   notes?: String | NullableStringFieldUpdateOperationsInput | Null,\n      ?   dateCreated?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   dateUpdated?: DateTime | DateTimeFieldUpdateOperationsInput,\n      ?   organization?: OrganizationUpdateOneRequiredWithoutAppointmentsNestedInput,\n      ?   patient?: PatientUpdateOneRequiredWithoutAppointmentsNestedInput,\n      ?   doctor?: UserUpdateOneWithoutAppointmentsNestedInput\n        },\n        include: {\n          patient: true,\n          doctor: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              email: true\n            }\n          }\n        }\n      })\n\nUnknown argument `confirmedAt`. Available options are marked with ?."}]}
Testing: Get Appointment Statistics... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 7. Billing Module Tests ===[0m
[0;31mâœ— Failed to create invoice[0m
Testing: List Invoices... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Create Payment... [0;31mâœ— FAILED[0m (Expected: 201, Got: 400)
Response: {"errors":[{"message":"Invoice ID is required"}]}
Testing: Get Patient Outstanding... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get Billing Statistics... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 8. Lab Module Tests ===[0m
[0;31mâœ— Failed to order lab test[0m
Testing: List Lab Tests... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Collect Lab Sample... [0;31mâœ— FAILED[0m (Expected: 201, Got: 404)
Response: <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Error</title>
</head>
<body>
<pre>Cannot POST /api/lab/tests//samples</pre>
</body>
</html>
Testing: Get Lab Statistics... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 9. Radiology Module Tests ===[0m
[0;31mâœ— Failed to order radiology test[0m
Testing: List Radiology Tests... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get Radiology Statistics... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 10. Pharmacy Module Tests ===[0m
[0;31mâœ— Failed to create medicine[0m
Testing: List Medicines... [0;32mâœ“ PASSED[0m (HTTP 200)
[0;31mâœ— Failed to create prescription[0m
Testing: List Prescriptions... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get Pharmacy Statistics... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Get Low Stock Medicines... [0;32mâœ“ PASSED[0m (HTTP 200)

[0;34m=== 11. Subscription Plans Tests ===[0m
Testing: List Subscription Plans... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Create Subscription Plan... [0;32mâœ“ PASSED[0m (HTTP 201)

[0;34m=== 12. Promotions Tests ===[0m
Testing: List Promotions... [0;32mâœ“ PASSED[0m (HTTP 200)
Testing: Create Promotion... [0;31mâœ— FAILED[0m (Expected: 201, Got: 400)
Response: {"error":"\nInvalid `prisma.promotion.create()` invocation in\n/root/hospital-backend/server.js:341:46\n\n  338   data.endDate = new Date(data.endDate + 'T23:59:59.999Z').toISOString();\n  339 }\n  340 \nâ†’ 341 const promotion = await prisma.promotion.create(\nUnique constraint failed on the fields: (`code`)"}

[0;34m=== 13. Dashboard Statistics Tests ===[0m
Testing: Get Dashboard Statistics... [0;32mâœ“ PASSED[0m (HTTP 200)

========================================
TEST SUMMARY
========================================
Total Tests: 53
[0;32mPassed: 40[0m
[0;31mFailed: 13[0m
[1;33mâš  Some tests failed[0m
Success Rate: 75%
Completed: Tue Dec  2 08:34:00 PM UTC 2025
========================================

Test results saved to: /root/hospital-backend/test-results
Test log: /root/hospital-backend/test-results/test_log_20251202_203354.txt
Test summary: /root/hospital-backend/test-results/test_summary_20251202_203354.json
